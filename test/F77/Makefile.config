TOPDIR = ../..
CONFIG_PATH ?= $(CURDIR)/
CONFIG_FILE  = $(CONFIG_PATH)config/make.$(CONFIG).inc

include $(TOPDIR)/make.inc
include $(CONFIG_FILE)

TESTBASE_SOURCE_FILES = $(wildcard *.f)
TESTBASE_OBJECT_FILES = $(patsubst %.f, %.o, $(TESTBASE_SOURCE_FILES))
TESTBASE_TARGET_FILES = $(patsubst %.f, %_$(CONFIG), $(TESTBASE_SOURCE_FILES))

F77BLAS_LIB           = $(TOPDIR)/$(F77BLAS_LIB_NAME)
LDLIBS               += $(F77BLAS_LIB) -lstdc++

F77MAKEFILE_PATH      = $(TOPDIR)/interfaces/blas/F77/

all :  $(TESTBASE_TARGET_FILES)
	set -e; $(RM) F77_DBLAT1.SUMM.$(SUMMARY_SUFFIX); ./dblat1_$(CONFIG) > $(TOPDIR)/F77_DBLAT1.SUMM.$(SUMMARY_SUFFIX);
	set -e; $(RM) F77_SBLAT1.SUMM.$(SUMMARY_SUFFIX); ./sblat1_$(CONFIG) > $(TOPDIR)/F77_SBLAT1.SUMM.$(SUMMARY_SUFFIX);
	set -e; $(RM) F77_CBLAT1.SUMM.$(SUMMARY_SUFFIX); ./cblat1_$(CONFIG) > $(TOPDIR)/F77_CBLAT1.SUMM.$(SUMMARY_SUFFIX);
	set -e; $(RM) F77_ZBLAT1.SUMM.$(SUMMARY_SUFFIX); ./zblat1_$(CONFIG) > $(TOPDIR)/F77_ZBLAT1.SUMM.$(SUMMARY_SUFFIX);
	set -e; $(RM) F77_SBLAT2.SUMM.$(SUMMARY_SUFFIX); sed 's,SBLAT2\.SUMM,F77_SBLAT2.SUMM.$(SUMMARY_SUFFIX),' < sblat2.dat.in > sblat2.dat; ./sblat2_$(CONFIG) < sblat2.dat; mv F77_SBLAT2.SUMM.$(SUMMARY_SUFFIX) $(TOPDIR)
	set -e; $(RM) F77_DBLAT2.SUMM.$(SUMMARY_SUFFIX); sed 's,DBLAT2\.SUMM,F77_DBLAT2.SUMM.$(SUMMARY_SUFFIX),' < dblat2.dat.in > dblat2.dat; ./dblat2_$(CONFIG) < dblat2.dat; mv F77_DBLAT2.SUMM.$(SUMMARY_SUFFIX) $(TOPDIR)
	set -e; $(RM) F77_CBLAT2.SUMM.$(SUMMARY_SUFFIX); sed 's,CBLAT2\.SUMM,F77_CBLAT2.SUMM.$(SUMMARY_SUFFIX),' < cblat2.dat.in > cblat2.dat; ./cblat2_$(CONFIG) < cblat2.dat; mv F77_CBLAT2.SUMM.$(SUMMARY_SUFFIX) $(TOPDIR)
	set -e; $(RM) F77_ZBLAT2.SUMM.$(SUMMARY_SUFFIX); sed 's,ZBLAT2\.SUMM,F77_ZBLAT2.SUMM.$(SUMMARY_SUFFIX),' < zblat2.dat.in > zblat2.dat; ./zblat2_$(CONFIG) < zblat2.dat; mv F77_ZBLAT2.SUMM.$(SUMMARY_SUFFIX) $(TOPDIR)
	set -e; $(RM) F77_SBLAT3.SUMM.$(SUMMARY_SUFFIX); sed 's,SBLAT3\.SUMM,F77_SBLAT3.SUMM.$(SUMMARY_SUFFIX),' < sblat3.dat.in > sblat3.dat; ./sblat3_$(CONFIG) < sblat3.dat; mv F77_SBLAT3.SUMM.$(SUMMARY_SUFFIX) $(TOPDIR)
	set -e; $(RM) F77_DBLAT3.SUMM.$(SUMMARY_SUFFIX); sed 's,DBLAT3\.SUMM,F77_DBLAT3.SUMM.$(SUMMARY_SUFFIX),' < dblat3.dat.in > dblat3.dat; ./dblat3_$(CONFIG) < dblat3.dat; mv F77_DBLAT3.SUMM.$(SUMMARY_SUFFIX) $(TOPDIR)
	set -e; $(RM) F77_CBLAT3.SUMM.$(SUMMARY_SUFFIX); sed 's,CBLAT3\.SUMM,F77_CBLAT3.SUMM.$(SUMMARY_SUFFIX),' < cblat3.dat.in > cblat3.dat; ./cblat3_$(CONFIG) < cblat3.dat; mv F77_CBLAT3.SUMM.$(SUMMARY_SUFFIX) $(TOPDIR)
	set -e; $(RM) F77_ZBLAT3.SUMM.$(SUMMARY_SUFFIX); sed 's,ZBLAT3\.SUMM,F77_ZBLAT3.SUMM.$(SUMMARY_SUFFIX),' < zblat3.dat.in > zblat3.dat; ./zblat3_$(CONFIG) < zblat3.dat; mv F77_ZBLAT3.SUMM.$(SUMMARY_SUFFIX) $(TOPDIR)

$(TESTBASE_TARGET_FILES): $(TESTBASE_OBJECT_FILES) $(F77BLAS_LIB)

%_$(CONFIG) : %.o
	$(CXX) $(LDFLAGS) $(LDF77FLAGS) $(LDF77LIBS) -o $@ $< $(LDLIBS)

clean:
	$(RM) $(TESTBASE_TARGET_FILES) $(TESTBASE_OBJECT_FILES) $(TOPDIR)/F77_*.SUMM.*
